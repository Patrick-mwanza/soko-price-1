{
  "meta": {
    "project": "SokoPrice",
    "date": "2026-02-21",
    "prepared_by": "Generated by TestSprite"
  },
  "product_overview": "SokoPrice is a real-time agricultural market price platform that provides farmers (including via USSD) and buyers with live prices, historical analytics and an admin approval workflow. It supports web dashboards (admin and buyer), USSD/SMS access for basic phones, and role-based authenticated operations.",
  "core_goals": [
    "Provide farmers with instant market prices via Safaricom-style USSD (no smartphone required).",
    "Offer secure web dashboards for admins and buyers with real-time prices and analytics.",
    "Support an approval workflow for submitted prices to ensure data quality and compute confidence-weighted approved prices.",
    "Enable SMS alert subscriptions and bulk messaging for price thresholds and daily summaries.",
    "Design a scalable, production-ready architecture with stateless APIs, MongoDB, and clear deployment guidance.",
    "Implement JWT authentication and role-based access control for admin-only operations and input validation."
  ],
  "features": [
    {
      "name": "Landing Page",
      "description": "Public-facing hero page that introduces SokoPrice, highlights features, and routes users to login or start using the service.",
      "user_flows": [
        "/ -> View the hero section with SokoPrice branding -> See feature highlight cards -> Click Get Started button -> Click Login button to navigate to /login",
        "/ -> See feature highlight cards -> Click Login button to navigate to /login -> See /login page with email and password fields (error flow: not authenticated for protected pages afterwards)"
      ]
    },
    {
      "name": "User Login",
      "description": "Email/password authentication for admin and buyer users; unsuccessful attempts show inline errors and successful login issues a JWT and redirects to the appropriate dashboard.",
      "user_flows": [
        "/login -> Fill email input field with admin@sokoprice.co.ke -> Fill password input field with Admin@123456 -> Click Login button to submit -> Redirected to /dashboard",
        "/login -> Fill email input field with admin@sokoprice.co.ke -> Fill password input field with wrong-password -> Click Login button to submit -> See error message on invalid credentials"
      ]
    },
    {
      "name": "Admin Dashboard",
      "description": "Authenticated admin overview showing key statistics, recent submissions, and navigation to admin pages (prices, sources, analytics).",
      "user_flows": [
        "/dashboard -> See stat cards showing totalUsers, activeMarkets, pricesToday, pendingApprovals -> View recent price submissions table -> Click navigation link to /prices",
        "/dashboard -> Attempt to load overview data when backend is offline -> See error/banner indicating analytics overview failed to load (error flow)"
      ]
    },
    {
      "name": "Price Management",
      "description": "Admin interface to view submitted prices, inspect confidence scores, and Approve/Reject entries pending moderation.",
      "user_flows": [
        "/prices -> View table of submitted prices with crop, market, price, source, and date -> Click Approve button on a pending price -> See the price marked as approved or removed from pending list",
        "/prices -> View table of submitted prices -> Click Reject button on a pending price -> See price removed from pending list or flagged as rejected",
        "/prices -> Click Approve button -> Network request fails -> See inline error message and retry option (error flow)"
      ]
    },
    {
      "name": "Source Management",
      "description": "Admin page to view and manage data sources (farmers, traders, officials) including reliability scores and status indicators.",
      "user_flows": [
        "/sources -> View table of data sources with name, role, phone number, and reliability score -> Click a source row to view details and reliability score indicators",
        "/sources -> Attempt to load sources when user session is unauthenticated -> Redirected to /login (error flow)"
      ]
    },
    {
      "name": "Analytics",
      "description": "Interactive charts (line charts for trends, bar charts for market comparisons) with filters for crop and time period to support decision-making and report exports.",
      "user_flows": [
        "/analytics -> View price trend line charts over time -> Filter by crop and time period -> See charts update to reflect selected filters",
        "/analytics -> Select a crop/time period with no available data -> See 'No data available' message and recommended date range (error flow)"
      ]
    },
    {
      "name": "Buyer Dashboard",
      "description": "Buyer/NGO-focused dashboard presenting live market prices, historical trends, supply indicators and CSV export for reports.",
      "user_flows": [
        "/buyer -> View live market prices table -> Filter by crop and market -> View updated historical price trend charts -> Click Export Report button to download CSV",
        "/buyer -> Click Export Report button -> Export fails due to backend error -> See download error message and retry option (error flow)"
      ]
    },
    {
      "name": "USSD Interface (Safaricom-style)",
      "description": "Session-based USSD flow allowing farmers with basic phones to check prices, request SMS copies, and submit price reports for approval.",
      "user_flows": [
        "Dial USSD code *789# -> See Welcome Menu 'Welcome to SokoPrice' with options '1. Check market prices', '2. Submit today's price', '3. Language' -> Enter '1' to Check market prices -> See 'Select crop' menu -> Enter crop selection number (e.g., '1' for Maize) -> See 'Select market' menu -> Enter market selection number (e.g., '1' for Wakulima) -> See result screen with price, updated time and confidence -> Enter '1' to Get SMS copy -> Receive SMS confirmation (happy path)",
        "Dial USSD code *789# -> See Welcome Menu -> Enter an invalid menu option (e.g., '9') -> See 'Invalid selection' message and return to previous menu or session termination (error flow)"
      ]
    },
    {
      "name": "USSD Price Submission",
      "description": "USSD flow for traders/enumerators to submit today's price; submissions are stored as pending and require admin approval.",
      "user_flows": [
        "Dial USSD code *789# -> See Welcome Menu -> Enter '2' to Submit today's price -> See 'Select crop' menu -> Enter crop selection -> See 'Select market' menu -> Enter market selection -> See 'Enter price' prompt -> Enter numeric price -> See confirmation screen 'Confirm submission' -> Confirm submission -> See success message indicating price saved as pending approval",
        "Dial USSD code *789# -> Enter '2' to Submit today's price -> Reach 'Enter price' prompt -> Enter non-numeric or out-of-range value -> See 'Invalid price' error and be prompted to re-enter or cancel (error flow)"
      ]
    },
    {
      "name": "SMS Alerts & Subscriptions",
      "description": "Farmers can subscribe to price threshold alerts and daily summaries; system sends SMS via Africa's Talking or Safaricom and supports opt-in/opt-out.",
      "user_flows": [
        "Dial USSD code *789# -> Navigate to Alerts/Subscribe flow -> Select crop and market -> Enter target price threshold -> Confirm subscription -> Receive SMS confirmation 'Subscribed to alert' and subsequently receive SMS when threshold is met",
        "Dial USSD code *789# -> Navigate to Alerts -> Attempt to subscribe with invalid phone or declined confirmation -> See error message 'Subscription failed' and instructions to retry (error flow)"
      ]
    },
    {
      "name": "Confidence Scoring & Approval Impact",
      "description": "System computes a confidence score for submissions based on source reliability and variance; approved prices update weighted approved price displayed in analytics.",
      "user_flows": [
        "/prices -> View table of submitted prices -> Observe confidenceScore column for each row -> Click Approve on high-confidence submission -> Navigate to /analytics -> See updated approved (weighted) price reflected in trend charts",
        "/prices -> View a low-confidence submission flagged in the table -> Click Approve -> See admin confirmation modal warning about low confidence and require explicit confirmation (error/guard flow)"
      ]
    },
    {
      "name": "Authentication & Authorization (Security Flow)",
      "description": "JWT-based authentication and role-based access control to protect admin operations and rate-limited APIs.",
      "user_flows": [
        "/login -> Fill email and password -> Click Login button -> Receive JWT and access /dashboard or /buyer depending on role -> Attempt admin-only operation (approve price) -> Operation succeeds when role=Admin",
        "/dashboard -> Attempt to access /prices without valid JWT (e.g., expired token) -> Redirected to /login -> See message 'Session expired, please login again' (error flow)"
      ]
    }
  ],
  "code_summary": {
    "version": "2",
    "type": "frontend",
    "tech_stack": [
      "TypeScript",
      "React",
      "Vite",
      "React Router DOM",
      "Recharts",
      "CSS"
    ],
    "routes": [
      {
        "path": "/",
        "file": "src/App.tsx",
        "auth_required": false,
        "description": "Public landing page with hero section and feature highlights"
      },
      {
        "path": "/login",
        "file": "src/pages/LoginPage.tsx",
        "auth_required": false,
        "description": "Login page with email and password form"
      },
      {
        "path": "/dashboard",
        "file": "src/pages/DashboardPage.tsx",
        "auth_required": true,
        "description": "Admin dashboard with overview statistics"
      },
      {
        "path": "/prices",
        "file": "src/pages/PriceManagementPage.tsx",
        "auth_required": true,
        "description": "Price management table with approve/reject actions"
      },
      {
        "path": "/sources",
        "file": "src/pages/SourceManagementPage.tsx",
        "auth_required": true,
        "description": "Data source management page"
      },
      {
        "path": "/analytics",
        "file": "src/pages/AnalyticsPage.tsx",
        "auth_required": true,
        "description": "Analytics page with price trend charts"
      },
      {
        "path": "/buyer",
        "file": "src/pages/BuyerDashboardPage.tsx",
        "auth_required": true,
        "description": "Buyer dashboard with live prices and trends"
      }
    ],
    "features": [
      {
        "name": "Landing Page",
        "description": "Public facing landing page with hero section, feature cards, and navigation links",
        "files": [
          "src/App.tsx"
        ],
        "entry_route": "/",
        "user_interactions": [
          "View the hero section with SokoPrice branding",
          "See feature highlight cards",
          "Click Login button to navigate to /login",
          "Click Get Started button"
        ],
        "api_calls": [],
        "auth_required": false
      },
      {
        "name": "User Login",
        "description": "Login form for admin and buyer users with email/password authentication",
        "files": [
          "src/pages/LoginPage.tsx",
          "src/context/AuthContext.tsx",
          "src/services/api.ts"
        ],
        "entry_route": "/login",
        "user_interactions": [
          "Fill email input field with admin@sokoprice.co.ke",
          "Fill password input field with Admin@123456",
          "Click Login button to submit",
          "See error message on invalid credentials",
          "Redirected to /dashboard on successful login"
        ],
        "api_calls": [
          {
            "method": "POST",
            "endpoint": "/api/auth/login"
          }
        ],
        "auth_required": false
      },
      {
        "name": "Admin Dashboard",
        "description": "Overview dashboard showing stats cards for total users, active markets, prices today, and pending approvals",
        "files": [
          "src/pages/DashboardPage.tsx",
          "src/services/api.ts"
        ],
        "entry_route": "/dashboard",
        "user_interactions": [
          "View stat cards showing totalUsers, activeMarkets, pricesToday, pendingApprovals",
          "View recent price submissions table",
          "Click navigation links to other admin pages"
        ],
        "api_calls": [
          {
            "method": "GET",
            "endpoint": "/api/analytics/overview"
          },
          {
            "method": "GET",
            "endpoint": "/api/prices?limit=5"
          }
        ],
        "auth_required": true
      },
      {
        "name": "Price Management",
        "description": "Admin page for viewing submitted prices, approving or rejecting them",
        "files": [
          "src/pages/PriceManagementPage.tsx",
          "src/services/api.ts"
        ],
        "entry_route": "/prices",
        "user_interactions": [
          "View table of submitted prices with crop, market, price, source, and date",
          "Click Approve button to approve a pending price",
          "Click Reject button to reject and remove a price",
          "Filter prices by approval status"
        ],
        "api_calls": [
          {
            "method": "GET",
            "endpoint": "/api/prices"
          },
          {
            "method": "PATCH",
            "endpoint": "/api/prices/:id/approve"
          },
          {
            "method": "PATCH",
            "endpoint": "/api/prices/:id/reject"
          }
        ],
        "auth_required": true
      },
      {
        "name": "Source Management",
        "description": "Admin page for viewing and managing data sources (farmers, traders, officials)",
        "files": [
          "src/pages/SourceManagementPage.tsx",
          "src/services/api.ts"
        ],
        "entry_route": "/sources",
        "user_interactions": [
          "View table of data sources with name, role, phone number, and reliability score",
          "See reliability score indicators"
        ],
        "api_calls": [
          {
            "method": "GET",
            "endpoint": "/api/sources"
          }
        ],
        "auth_required": true
      },
      {
        "name": "Analytics",
        "description": "Analytics page with interactive Recharts line charts for price trends and bar charts for market comparisons",
        "files": [
          "src/pages/AnalyticsPage.tsx",
          "src/services/api.ts"
        ],
        "entry_route": "/analytics",
        "user_interactions": [
          "View price trend line charts over time",
          "View market comparison bar charts",
          "Filter by crop and time period"
        ],
        "api_calls": [
          {
            "method": "GET",
            "endpoint": "/api/analytics/trends"
          },
          {
            "method": "GET",
            "endpoint": "/api/analytics/compare"
          }
        ],
        "auth_required": true
      },
      {
        "name": "Buyer Dashboard",
        "description": "Buyer/NGO dashboard with live market prices, historical trends, supply indicators, and CSV export",
        "files": [
          "src/pages/BuyerDashboardPage.tsx",
          "src/services/api.ts"
        ],
        "entry_route": "/buyer",
        "user_interactions": [
          "View live market prices table",
          "View historical price trend charts",
          "Filter by crop and market",
          "Click Export Report button to download CSV",
          "View supply level indicators"
        ],
        "api_calls": [
          {
            "method": "GET",
            "endpoint": "/api/prices"
          },
          {
            "method": "GET",
            "endpoint": "/api/crops"
          },
          {
            "method": "GET",
            "endpoint": "/api/markets"
          }
        ],
        "auth_required": true
      }
    ],
    "known_limitations": [
      {
        "issue": "Frontend requires backend API running on port 5000",
        "location": "src/services/api.ts",
        "impact": "All API calls will fail if the backend Express server is not running"
      },
      {
        "issue": "Login required for most pages - use admin@sokoprice.co.ke / Admin@123456",
        "location": "src/context/AuthContext.tsx",
        "impact": "Unauthenticated users are redirected to /login"
      }
    ]
  }
}
