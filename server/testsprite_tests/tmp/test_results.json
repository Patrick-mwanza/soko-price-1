[
  {
    "projectId": "f251f7d1-a71c-4b41-9775-f49a6e1502f7",
    "testId": "ad9b590b-eb4f-48a4-805f-f130bf36a286",
    "userId": "b4d8b488-20d1-7050-62f0-7a49ad314202",
    "title": "TC001-post api auth register user registration",
    "description": "Test user registration with valid name, email, and password to receive 201 status with JWT token and user details including role and language.",
    "code": "import requests\nimport uuid\n\ndef test_post_api_auth_register_user_registration():\n    base_url = \"http://localhost:5000\"\n    url = f\"{base_url}/api/auth/register\"\n    headers = {\n        \"Content-Type\": \"application/json\"\n    }\n    unique_email = f\"testuser_{uuid.uuid4().hex[:8]}@example.com\"\n    payload = {\n        \"name\": \"Test User\",\n        \"email\": unique_email,\n        \"password\": \"SecurePass123!\"\n    }\n\n    try:\n        response = requests.post(url, json=payload, headers=headers, timeout=30)\n        assert response.status_code == 201, f\"Expected 201, got {response.status_code}\"\n        data = response.json()\n        # Validate presence of token and user info fields\n        assert \"token\" in data, \"Response missing 'token'\"\n        assert \"user\" in data, \"Response missing 'user'\"\n        user = data[\"user\"]\n        # Validate user details fields\n        assert \"id\" in user and isinstance(user[\"id\"], str) and user[\"id\"], \"User id invalid or missing\"\n        assert user.get(\"name\") == payload[\"name\"], \"User name mismatch\"\n        assert user.get(\"email\") == payload[\"email\"], \"User email mismatch\"\n        assert \"role\" in user and isinstance(user[\"role\"], str) and user[\"role\"], \"User role invalid or missing\"\n        assert \"language\" in user and isinstance(user[\"language\"], str) and user[\"language\"], \"User language invalid or missing\"\n    except requests.RequestException as e:\n        assert False, f\"Request failed: {e}\"\n\ntest_post_api_auth_register_user_registration()\n",
    "testStatus": "PASSED",
    "testError": "",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2026-02-22T05:46:26.235Z",
    "modified": "2026-02-22T05:46:53.315Z"
  },
  {
    "projectId": "f251f7d1-a71c-4b41-9775-f49a6e1502f7",
    "testId": "dd131437-d433-4bcc-847d-1b4e344d9d14",
    "userId": "b4d8b488-20d1-7050-62f0-7a49ad314202",
    "title": "TC002-post api auth login user authentication",
    "description": "Test user login with valid email and password to receive 200 status with JWT token and user information.",
    "code": "import requests\n\nBASE_URL = \"http://localhost:5000\"\nLOGIN_PATH = \"/api/auth/login\"\nTIMEOUT = 30\n\ndef test_post_api_auth_login_user_authentication():\n    url = BASE_URL + LOGIN_PATH\n    headers = {\n        \"Content-Type\": \"application/json\"\n    }\n    # Use valid credentials from known limitations or environment\n    payload = {\n        \"email\": \"buyer@sokoprice.co.ke\",\n        \"password\": \"Buyer@123456\"\n    }\n\n    try:\n        response = requests.post(url, json=payload, headers=headers, timeout=TIMEOUT)\n    except requests.RequestException as e:\n        assert False, f\"HTTP request failed: {e}\"\n\n    assert response.status_code == 200, f\"Expected status code 200 but got {response.status_code}\"\n    try:\n        data = response.json()\n    except ValueError:\n        assert False, \"Response is not valid JSON\"\n    \n    assert \"token\" in data and isinstance(data[\"token\"], str) and data[\"token\"], \"Missing or invalid token in response\"\n    assert \"user\" in data and isinstance(data[\"user\"], dict), \"Missing or invalid user object in response\"\n    user = data[\"user\"]\n    assert \"id\" in user and user[\"id\"], \"User id missing or empty\"\n    assert \"name\" in user and isinstance(user[\"name\"], str) and user[\"name\"], \"User name missing or empty\"\n    assert \"email\" in user and user[\"email\"] == payload[\"email\"], \"User email missing or does not match\"\n    assert \"role\" in user and isinstance(user[\"role\"], str) and user[\"role\"], \"User role missing or empty\"\n    assert \"language\" in user and isinstance(user[\"language\"], str), \"User language missing or invalid\"\n\ntest_post_api_auth_login_user_authentication()",
    "testStatus": "PASSED",
    "testError": "",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2026-02-22T05:46:26.243Z",
    "modified": "2026-02-22T05:46:55.270Z"
  },
  {
    "projectId": "f251f7d1-a71c-4b41-9775-f49a6e1502f7",
    "testId": "8386a209-e0db-40ae-8e7e-02c79def6256",
    "userId": "b4d8b488-20d1-7050-62f0-7a49ad314202",
    "title": "TC003-get api auth me authenticated user profile retrieval",
    "description": "Test retrieval of authenticated user profile with valid JWT token to receive 200 status with user details including phoneNumber and role.",
    "code": "import requests\n\nBASE_URL = \"http://localhost:5000\"\n\nADMIN_EMAIL = \"admin@sokoprice.co.ke\"\nADMIN_PASSWORD = \"Admin@123456\"\n\ndef test_get_api_auth_me_authenticated_user_profile_retrieval():\n    session = requests.Session()\n    try:\n        # Login to get JWT token\n        login_url = f\"{BASE_URL}/api/auth/login\"\n        login_payload = {\n            \"email\": ADMIN_EMAIL,\n            \"password\": ADMIN_PASSWORD\n        }\n        login_resp = session.post(login_url, json=login_payload, timeout=30)\n        assert login_resp.status_code == 200, f\"Login failed: {login_resp.status_code} {login_resp.text}\"\n        login_data = login_resp.json()\n        assert \"token\" in login_data and \"user\" in login_data, \"Login response missing token or user\"\n        token = login_data[\"token\"]\n        user_info = login_data[\"user\"]\n        # Prepare Authorization header\n        headers = {\n            \"Authorization\": f\"Bearer {token}\"\n        }\n        # Get authenticated user profile\n        me_url = f\"{BASE_URL}/api/auth/me\"\n        me_resp = session.get(me_url, headers=headers, timeout=30)\n        assert me_resp.status_code == 200, f\"Fetching user profile failed: {me_resp.status_code} {me_resp.text}\"\n        me_data = me_resp.json()\n        assert \"user\" in me_data, \"Response missing 'user' key\"\n        user = me_data[\"user\"]\n        # Check required user details\n        expected_fields = [\"id\", \"name\", \"email\", \"role\", \"language\", \"phoneNumber\"]\n        for field in expected_fields:\n            assert field in user, f\"User profile missing field '{field}'\"\n        # role should be non-empty string\n        assert isinstance(user[\"role\"], str) and user[\"role\"], \"User role is empty or invalid\"\n        # phoneNumber should be a string, possibly empty or valid phone format\n        assert isinstance(user[\"phoneNumber\"], str), \"User phoneNumber is not a string\"\n    finally:\n        session.close()\n\ntest_get_api_auth_me_authenticated_user_profile_retrieval()\n",
    "testStatus": "PASSED",
    "testError": "",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2026-02-22T05:46:26.249Z",
    "modified": "2026-02-22T05:47:10.313Z"
  },
  {
    "projectId": "f251f7d1-a71c-4b41-9775-f49a6e1502f7",
    "testId": "c8c6ce1d-fcc6-4c3c-aa8f-4f64a8709859",
    "userId": "b4d8b488-20d1-7050-62f0-7a49ad314202",
    "title": "TC004-post api ussd process incoming ussd session",
    "description": "Test processing of USSD session with valid sessionId, serviceCode, phoneNumber, and text input to receive 200 status with CON or END text response for menu navigation.",
    "code": "import requests\nimport uuid\n\nBASE_URL = \"http://localhost:5000\"\nAPI_PATH = \"/api/ussd\"\nTIMEOUT = 30\n\ndef test_post_api_ussd_process_incoming_ussd_session():\n    url = BASE_URL + API_PATH\n    headers = {\n        \"Content-Type\": \"application/json\"\n    }\n\n    # Generate a random sessionId to simulate a unique USSD session\n    session_id = str(uuid.uuid4())\n    service_code = \"*123#\"\n    phone_number = \"+254700000000\"\n    text_inputs = [\"\", \"1\", \"1*1\", \"1*1*1\"]  # Sequence of valid USSD menu navigation inputs\n\n    for text in text_inputs:\n        payload = {\n            \"sessionId\": session_id,\n            \"serviceCode\": service_code,\n            \"phoneNumber\": phone_number,\n            \"text\": text\n        }\n\n        try:\n            response = requests.post(url, json=payload, headers=headers, timeout=TIMEOUT)\n            assert response.status_code == 200, f\"Expected status code 200 for text='{text}', got {response.status_code}\"\n            assert response.headers.get(\"Content-Type\", \"\").startswith(\"text/plain\"), f\"Response Content-Type is not text/plain for text='{text}'\"\n\n            response_text = response.text.strip()\n            assert response_text.startswith(\"CON\") or response_text.startswith(\"END\"), \\\n                f\"Response text must start with 'CON' or 'END' for text='{text}', got: {response_text}\"\n\n        except requests.RequestException as e:\n            assert False, f\"Request failed for text='{text}' with exception: {e}\"\n\ntest_post_api_ussd_process_incoming_ussd_session()",
    "testStatus": "PASSED",
    "testError": "",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2026-02-22T05:46:26.255Z",
    "modified": "2026-02-22T05:47:02.516Z"
  },
  {
    "projectId": "f251f7d1-a71c-4b41-9775-f49a6e1502f7",
    "testId": "9fe42be5-454a-43ff-8a8a-afdff44e2e77",
    "userId": "b4d8b488-20d1-7050-62f0-7a49ad314202",
    "title": "TC005-get api prices list crop market prices",
    "description": "Test listing of crop market prices with optional filters cropId, marketId, and approved to receive 200 status with paginated price data.",
    "code": "import requests\n\nBASE_URL = \"http://localhost:5000\"\nTIMEOUT = 30\n\ndef test_get_api_prices_list_crop_market_prices():\n    \"\"\"\n    Test listing of crop market prices with optional filters cropId, marketId, and approved\n    to receive 200 status with paginated price data.\n    \"\"\"\n    try:\n        # First, fetch list of crops to get a valid cropId filter option\n        crops_resp = requests.get(f\"{BASE_URL}/api/crops\", timeout=TIMEOUT)\n        assert crops_resp.status_code == 200, f\"Expected 200 for crops list but got {crops_resp.status_code}\"\n        crops = crops_resp.json()\n        crop_id = crops[0]['id'] if crops and 'id' in crops[0] else (crops[0]['_id'] if crops and '_id' in crops[0] else None)\n\n        # Fetch list of markets to get a valid marketId filter option\n        markets_resp = requests.get(f\"{BASE_URL}/api/markets\", timeout=TIMEOUT)\n        assert markets_resp.status_code == 200, f\"Expected 200 for markets list but got {markets_resp.status_code}\"\n        markets = markets_resp.json()\n        market_id = markets[0]['id'] if markets and 'id' in markets[0] else (markets[0]['_id'] if markets and '_id' in markets[0] else None)\n\n        # Build query params with optional filters\n        params = {}\n        if crop_id:\n            params['cropId'] = crop_id\n        if market_id:\n            params['marketId'] = market_id\n        params['approved'] = 'true'\n\n        # Make GET request to /api/prices with filters\n        response = requests.get(f\"{BASE_URL}/api/prices\", params=params, timeout=TIMEOUT)\n        \n        assert response.status_code == 200, f\"Expected 200 but got {response.status_code}\"\n        \n        data = response.json()\n        \n        # Validate response schema contains required keys\n        assert isinstance(data, dict), \"Response is not a JSON object\"\n        assert 'prices' in data, \"'prices' key missing in response\"\n        assert 'total' in data, \"'total' key missing in response\"\n        assert 'page' in data, \"'page' key missing in response\"\n        assert 'pages' in data, \"'pages' key missing in response\"\n        assert isinstance(data['prices'], list), \"'prices' should be a list\"\n        \n        # Optionally more detailed validation of prices objects can be done here\n        for price in data['prices']:\n            assert 'id' in price or '_id' in price, \"Price object missing id\"\n            assert 'cropId' in price, \"Price object missing cropId\"\n            assert 'marketId' in price, \"Price object missing marketId\"\n            assert 'price' in price, \"Price object missing price\"\n            assert 'approved' in price, \"Price object missing approved status\"\n\n    except requests.RequestException as e:\n        assert False, f\"Request failed: {e}\"\n\ntest_get_api_prices_list_crop_market_prices()\n",
    "testStatus": "PASSED",
    "testError": "",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2026-02-22T05:46:26.262Z",
    "modified": "2026-02-22T05:47:20.771Z"
  },
  {
    "projectId": "f251f7d1-a71c-4b41-9775-f49a6e1502f7",
    "testId": "63af0d32-eb4c-43b0-9d65-e7bc5eac8ea7",
    "userId": "b4d8b488-20d1-7050-62f0-7a49ad314202",
    "title": "TC006-post api prices submit new price report",
    "description": "Test submission of new crop price report with valid cropId, marketId, price, sourceId, and notes to receive 201 status with created Price object in pending status.",
    "code": "import requests\n\nBASE_URL = \"http://localhost:5000\"\nTIMEOUT = 30\n\ndef test_post_api_prices_submit_new_price_report():\n    # Step 1: Retrieve available crops to get a valid cropId\n    crops_resp = requests.get(f\"{BASE_URL}/api/crops\", timeout=TIMEOUT)\n    assert crops_resp.status_code == 200, f\"Failed to get crops: {crops_resp.text}\"\n    crops = crops_resp.json()\n    assert isinstance(crops, list) and len(crops) > 0, \"No crops available to use.\"\n    crop_id = crops[0].get('id') or crops[0].get('_id')\n    assert crop_id, \"cropId not found in crop data.\"\n    \n    # Step 2: Retrieve available markets to get a valid marketId\n    markets_resp = requests.get(f\"{BASE_URL}/api/markets\", timeout=TIMEOUT)\n    assert markets_resp.status_code == 200, f\"Failed to get markets: {markets_resp.text}\"\n    markets = markets_resp.json()\n    assert isinstance(markets, list) and len(markets) > 0, \"No markets available to use.\"\n    market_id = markets[0].get('id') or markets[0].get('_id')\n    assert market_id, \"marketId not found in market data.\"\n\n    # Prepare payload for price submission\n    payload = {\n        \"cropId\": crop_id,\n        \"marketId\": market_id,\n        \"price\": 3500,\n        \"sourceId\": \"test-source-id-123\",\n        \"notes\": \"Test price submission from automated test\"\n    }\n    \n    price_obj = {}\n    # Submit the new price report\n    post_resp = requests.post(f\"{BASE_URL}/api/prices\", json=payload, timeout=TIMEOUT)\n    try:\n        assert post_resp.status_code == 201, f\"Expected 201 Created, got {post_resp.status_code}: {post_resp.text}\"\n        price_obj = post_resp.json()\n        assert isinstance(price_obj, dict), \"Response is not a JSON object.\"\n        # Validate returned Price object fields\n        keys_expected = {\"id\", \"_id\", \"cropId\", \"marketId\", \"price\", \"sourceId\", \"notes\", \"status\"}\n        assert any(k in price_obj for k in keys_expected), \"Price object missing expected keys.\"\n        # Check that returned fields match input where applicable\n        assert str(price_obj.get(\"cropId\")) == str(crop_id), f\"cropId mismatch. Expected {crop_id}, got {price_obj.get('cropId')}\"\n        assert str(price_obj.get(\"marketId\")) == str(market_id), f\"marketId mismatch. Expected {market_id}, got {price_obj.get('marketId')}\"\n        assert price_obj.get(\"price\") == 3500, \"price value mismatch.\"\n        assert price_obj.get(\"sourceId\") == payload[\"sourceId\"], \"sourceId mismatch.\"\n        assert price_obj.get(\"notes\") == payload[\"notes\"], \"notes mismatch.\"\n        # Status should be 'pending'\n        status = price_obj.get(\"status\")\n        assert status == \"pending\", f\"Expected status 'pending', got '{status}'.\"\n    finally:\n        # Cleanup: try to delete the created price object if id available\n        price_id = price_obj.get(\"id\") or price_obj.get(\"_id\")\n        if price_id:\n            try:\n                del_resp = requests.delete(f\"{BASE_URL}/api/prices/{price_id}\", timeout=TIMEOUT)\n                # Deletion may return 200 or 204 or 404 if not found\n                assert del_resp.status_code in (200, 204, 404), f\"Failed to delete created price: {del_resp.status_code}\"\n            except Exception:\n                pass\n\ntest_post_api_prices_submit_new_price_report()\n",
    "testStatus": "FAILED",
    "testError": "Traceback (most recent call last):\n  File \"/var/task/handler.py\", line 258, in run_with_retry\n    exec(code, exec_env)\n  File \"<string>\", line 62, in <module>\n  File \"<string>\", line 43, in test_post_api_prices_submit_new_price_report\nAssertionError: cropId mismatch. Expected 699a79d2f40dfadb9169a7ba, got {'_id': '699a79d2f40dfadb9169a7ba', 'name': 'Beans', 'unit': '90kg bag', 'code': 'beans', 'id': '699a79d2f40dfadb9169a7ba'}\n",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2026-02-22T05:46:26.268Z",
    "modified": "2026-02-22T05:48:00.812Z"
  },
  {
    "projectId": "f251f7d1-a71c-4b41-9775-f49a6e1502f7",
    "testId": "9ddff99c-749e-44e9-9ca1-62edde2d4e20",
    "userId": "b4d8b488-20d1-7050-62f0-7a49ad314202",
    "title": "TC007-patch api prices id approve admin price approval",
    "description": "Test admin approval of pending price by PATCHing /api/prices/:id/approve with valid admin JWT token to receive 200 status with updated Price object marked as approved.",
    "code": "import requests\nimport uuid\n\nBASE_URL = \"http://localhost:5000\"\nADMIN_EMAIL = \"admin@sokoprice.co.ke\"\nADMIN_PASSWORD = \"Admin@123456\"\nTIMEOUT = 30\n\ndef test_patch_api_prices_id_approve_admin_price_approval():\n    session = requests.Session()\n    try:\n        # 1. Login as admin to get JWT token\n        login_resp = session.post(\n            f\"{BASE_URL}/api/auth/login\",\n            json={\"email\": ADMIN_EMAIL, \"password\": ADMIN_PASSWORD},\n            timeout=TIMEOUT\n        )\n        assert login_resp.status_code == 200, f\"Admin login failed: {login_resp.text}\"\n        login_data = login_resp.json()\n        token = login_data.get(\"token\")\n        assert token, \"No token received from admin login\"\n\n        headers_auth = {\"Authorization\": f\"Bearer {token}\"}\n\n        # 2. Get list of crops to get valid cropId for price submission\n        crops_resp = session.get(f\"{BASE_URL}/api/crops\", timeout=TIMEOUT)\n        assert crops_resp.status_code == 200, f\"Failed to get crops: {crops_resp.text}\"\n        crops = crops_resp.json()\n        assert isinstance(crops, list) and len(crops) > 0, \"No crops available\"\n        crop_id = crops[0][\"id\"] if \"id\" in crops[0] else crops[0].get(\"_id\")\n        assert crop_id, \"Invalid crop object - no id\"\n\n        # 3. Get list of markets to get valid marketId for price submission\n        markets_resp = session.get(f\"{BASE_URL}/api/markets\", timeout=TIMEOUT)\n        assert markets_resp.status_code == 200, f\"Failed to get markets: {markets_resp.text}\"\n        markets = markets_resp.json()\n        assert isinstance(markets, list) and len(markets) > 0, \"No markets available\"\n        market_id = markets[0][\"id\"] if \"id\" in markets[0] else markets[0].get(\"_id\")\n        assert market_id, \"Invalid market object - no id\"\n\n        # 4. Create a new price report (status should be pending)\n        price_submission = {\n            \"cropId\": crop_id,\n            \"marketId\": market_id,\n            \"price\": 1234,           # sample price\n            \"sourceId\": str(uuid.uuid4()),\n            \"notes\": \"Test price submission for approval\"\n        }\n        post_price_resp = session.post(\n            f\"{BASE_URL}/api/prices\",\n            json=price_submission,\n            timeout=TIMEOUT\n        )\n        assert post_price_resp.status_code == 201, f\"Failed to create price: {post_price_resp.text}\"\n        price_data = post_price_resp.json()\n        price_id = price_data.get(\"id\") or price_data.get(\"_id\")\n        assert price_id, \"Created price has no id\"\n        status_before = price_data.get(\"status\")\n        assert status_before == \"pending\", f\"Price status expected 'pending', got '{status_before}'\"\n\n        # 5. Approve the price using PATCH /api/prices/:id/approve with admin token\n        patch_resp = session.patch(\n            f\"{BASE_URL}/api/prices/{price_id}/approve\",\n            headers=headers_auth,\n            timeout=TIMEOUT\n        )\n        assert patch_resp.status_code == 200, f\"Approve request failed: {patch_resp.text}\"\n        approved_price = patch_resp.json()\n        assert (approved_price.get(\"id\") == price_id or approved_price.get(\"_id\") == price_id), \"Price ID mismatch after approval\"\n        status_after = approved_price.get(\"status\")\n        assert status_after == \"approved\", f\"Price status expected 'approved', got '{status_after}'\"\n\n    finally:\n        # Cleanup: Delete the created price if still exists & if API supports deletion (not in PRD)\n        # Since no DELETE endpoint described, try reject as a cleanup if still pending or approved\n        # Login steps already done, reuse headers_auth and session\n        if 'price_id' in locals():\n            try:\n                session.patch(\n                    f\"{BASE_URL}/api/prices/{price_id}/reject\",\n                    headers=headers_auth,\n                    timeout=TIMEOUT\n                )\n            except Exception:\n                pass\n\ntest_patch_api_prices_id_approve_admin_price_approval()\n",
    "testStatus": "PASSED",
    "testError": "",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2026-02-22T05:46:26.274Z",
    "modified": "2026-02-22T05:47:41.887Z"
  },
  {
    "projectId": "f251f7d1-a71c-4b41-9775-f49a6e1502f7",
    "testId": "6b49d19b-b5ea-47c9-84fe-577b56551c4f",
    "userId": "b4d8b488-20d1-7050-62f0-7a49ad314202",
    "title": "TC008-patch api prices id reject admin price rejection",
    "description": "Test admin rejection of pending price by PATCHing /api/prices/:id/reject with valid admin JWT token to receive 200 status with confirmation message of price rejection and removal.",
    "code": "import requests\nimport uuid\n\nBASE_URL = \"http://localhost:5000\"\nADMIN_EMAIL = \"admin@sokoprice.co.ke\"\nADMIN_PASSWORD = \"Admin@123456\"\nTIMEOUT = 30\n\n\ndef test_patch_api_prices_id_reject_admin_price_rejection():\n    headers = {\"Content-Type\": \"application/json\"}\n    token = None\n    price_id = None\n\n    # Helper to login as admin and get JWT token\n    def admin_login():\n        login_url = f\"{BASE_URL}/api/auth/login\"\n        payload = {\"email\": ADMIN_EMAIL, \"password\": ADMIN_PASSWORD}\n        resp = requests.post(login_url, json=payload, timeout=TIMEOUT)\n        assert resp.status_code == 200, f\"Admin login failed: {resp.text}\"\n        json_resp = resp.json()\n        assert \"token\" in json_resp, \"No token found in login response\"\n        return json_resp[\"token\"]\n\n    # Helper to create a pending price to reject\n    def create_pending_price():\n        # Get list of crops\n        crops_url = f\"{BASE_URL}/api/crops\"\n        crops_resp = requests.get(crops_url, timeout=TIMEOUT)\n        assert crops_resp.status_code == 200, f\"Failed to get crops: {crops_resp.text}\"\n        crops = crops_resp.json()\n        assert isinstance(crops, list) and len(crops) > 0, \"No crops available\"\n        crop_id = crops[0].get(\"id\") or crops[0].get(\"_id\") or None\n        assert crop_id, \"Crop ID not found\"\n\n        # Get list of markets\n        markets_url = f\"{BASE_URL}/api/markets\"\n        markets_resp = requests.get(markets_url, timeout=TIMEOUT)\n        assert markets_resp.status_code == 200, f\"Failed to get markets: {markets_resp.text}\"\n        markets = markets_resp.json()\n        assert isinstance(markets, list) and len(markets) > 0, \"No markets available\"\n        market_id = markets[0].get(\"id\") or markets[0].get(\"_id\") or None\n        assert market_id, \"Market ID not found\"\n\n        # Create price\n        price_url = f\"{BASE_URL}/api/prices\"\n        price_payload = {\n            \"cropId\": crop_id,\n            \"marketId\": market_id,\n            \"price\": 1000,\n            \"sourceId\": str(uuid.uuid4()),\n            \"notes\": \"Test price for rejection\"\n        }\n        price_resp = requests.post(price_url, json=price_payload, timeout=TIMEOUT)\n        assert price_resp.status_code == 201, f\"Failed to create price: {price_resp.text}\"\n        price_data = price_resp.json()\n        _id = price_data.get(\"id\") or price_data.get(\"_id\") or None\n        assert _id, \"Created price ID not found\"\n        return _id\n\n    # Helper to delete a price (if still exists)\n    def delete_price(pid, token):\n        if not pid or not token:\n            return\n        delete_url = f\"{BASE_URL}/api/prices/{pid}/reject\"\n        hdrs = {\"Authorization\": f\"Bearer {token}\"}\n        # Attempt DELETE via reject endpoint (some APIs might remove on reject)\n        # But since this is a rejection test, we assume rejecting removes the price.\n        # So if the reject succeeded in test, no delete needed.\n        # But try anyway to clean up if something remains.\n        try:\n            resp = requests.patch(delete_url, headers=hdrs, timeout=TIMEOUT)\n            # ignore response, cleanup attempt\n        except Exception:\n            pass\n\n    try:\n        # Login admin\n        token = admin_login()\n        auth_headers = {\n            \"Authorization\": f\"Bearer {token}\",\n            \"Content-Type\": \"application/json\"\n        }\n\n        # Create a pending price to reject\n        price_id = create_pending_price()\n\n        # Reject the pending price\n        reject_url = f\"{BASE_URL}/api/prices/{price_id}/reject\"\n        reject_resp = requests.patch(reject_url, headers=auth_headers, timeout=TIMEOUT)\n        assert reject_resp.status_code == 200, f\"Reject request failed: {reject_resp.text}\"\n        reject_json = reject_resp.json()\n        assert isinstance(reject_json, dict), \"Reject response not a JSON object\"\n        assert \"message\" in reject_json, \"No message in reject response\"\n        assert reject_json[\"message\"].lower() == \"price rejected and removed\", \\\n            f\"Unexpected reject message: {reject_json['message']}\"\n\n        # Confirm price is removed by attempting to get it or listing prices and ensure not found\n        get_price_url = f\"{BASE_URL}/api/prices/{price_id}\"\n        get_resp = requests.get(get_price_url, timeout=TIMEOUT)\n        # Expecting 404 or similar since price should be removed\n        assert get_resp.status_code in (404, 400), \"Rejected price still accessible\"\n    finally:\n        # Cleanup attempt\n        if price_id and token:\n            delete_price(price_id, token)\n\n\ntest_patch_api_prices_id_reject_admin_price_rejection()\n",
    "testStatus": "PASSED",
    "testError": "",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2026-02-22T05:46:26.280Z",
    "modified": "2026-02-22T05:48:00.804Z"
  },
  {
    "projectId": "f251f7d1-a71c-4b41-9775-f49a6e1502f7",
    "testId": "feeff0f5-8190-4a8a-8f16-096b7f3ccf81",
    "userId": "b4d8b488-20d1-7050-62f0-7a49ad314202",
    "title": "TC009-get api analytics overview authenticated dashboard statistics",
    "description": "Test retrieval of dashboard overview statistics with valid admin JWT token to receive 200 status with totalUsers, activeMarkets, pricesToday, pendingApprovals, totalCrops, and totalSources.",
    "code": "import requests\n\nBASE_URL = \"http://localhost:5000\"\nADMIN_EMAIL = \"admin@sokoprice.co.ke\"\nADMIN_PASSWORD = \"Admin@123456\"\nTIMEOUT = 30\n\n\ndef test_get_api_analytics_overview_authenticated_dashboard_statistics():\n    # Log in as admin to get JWT token\n    login_url = f\"{BASE_URL}/api/auth/login\"\n    login_payload = {\n        \"email\": ADMIN_EMAIL,\n        \"password\": ADMIN_PASSWORD\n    }\n\n    try:\n        login_response = requests.post(login_url, json=login_payload, timeout=TIMEOUT)\n        login_response.raise_for_status()\n    except requests.RequestException as e:\n        assert False, f\"Admin login request failed: {e}\"\n\n    login_data = login_response.json()\n    assert \"token\" in login_data, \"No token in login response\"\n    token = login_data[\"token\"]\n    assert isinstance(token, str) and token, \"Invalid token value\"\n\n    # Get analytics overview with authorization\n    analytics_url = f\"{BASE_URL}/api/analytics/overview\"\n    headers = {\n        \"Authorization\": f\"Bearer {token}\"\n    }\n\n    try:\n        analytics_response = requests.get(analytics_url, headers=headers, timeout=TIMEOUT)\n        analytics_response.raise_for_status()\n    except requests.RequestException as e:\n        assert False, f\"Analytics overview request failed: {e}\"\n\n    assert analytics_response.status_code == 200, f\"Expected 200 OK, got {analytics_response.status_code}\"\n\n    overview = analytics_response.json()\n    expected_keys = [\n        \"totalUsers\",\n        \"activeMarkets\",\n        \"pricesToday\",\n        \"pendingApprovals\",\n        \"totalCrops\",\n        \"totalSources\"\n    ]\n\n    for key in expected_keys:\n        assert key in overview, f\"Missing key in response: {key}\"\n        # Values should be int or float (depending on backend)\n        assert isinstance(overview[key], (int, float)), f\"Key {key} should be number, got {type(overview[key])}\"\n\n\ntest_get_api_analytics_overview_authenticated_dashboard_statistics()\n",
    "testStatus": "PASSED",
    "testError": "",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2026-02-22T05:46:26.290Z",
    "modified": "2026-02-22T05:47:24.498Z"
  },
  {
    "projectId": "f251f7d1-a71c-4b41-9775-f49a6e1502f7",
    "testId": "637ff1a8-8894-495b-8148-7f05e8852b35",
    "userId": "b4d8b488-20d1-7050-62f0-7a49ad314202",
    "title": "TC010-get api crops list available crops",
    "description": "Test listing of all available crops via GET /api/crops to receive 200 status with array of Crop objects.",
    "code": "import requests\n\ndef test_get_api_crops_list_available_crops():\n    base_url = \"http://localhost:5000\"\n    url = f\"{base_url}/api/crops\"\n    headers = {\n        \"Accept\": \"application/json\"\n    }\n    try:\n        response = requests.get(url, headers=headers, timeout=30)\n        response.raise_for_status()\n    except requests.RequestException as e:\n        assert False, f\"Request to GET /api/crops failed: {e}\"\n\n    assert response.status_code == 200, f\"Expected status code 200 but got {response.status_code}\"\n    try:\n        crops = response.json()\n    except ValueError:\n        assert False, \"Response body is not valid JSON\"\n\n    assert isinstance(crops, list), f\"Expected response body to be a list but got {type(crops)}\"\n    for crop in crops:\n        assert isinstance(crop, dict), f\"Each crop should be an object/dict but got {type(crop)}\"\n\n\ntest_get_api_crops_list_available_crops()\n",
    "testStatus": "PASSED",
    "testError": "",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2026-02-22T05:46:26.296Z",
    "modified": "2026-02-22T05:47:30.842Z"
  }
]
